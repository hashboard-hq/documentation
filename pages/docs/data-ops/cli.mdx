import { Callout, Card, Cards } from "nextra-theme-docs";

# Using the Hashboard CLI

The Hashboard CLI allows you to create Preview and Deploy Builds directly from your terminal or continuous integration system.

<<<<<<< HEAD
## Quickstart

### 1. Create an Access Key

To use the CLI with your Hashboard project, you need an **Access Key**. An Access Key is used by Hashboard to identify who you are and what resources you have access to. You should use a separate Access Key for each distinct user or service using the CLI.

1.  Go to the [`Settings`](https://hashboard.com/app/p/settings#access_keys) page using the link in the project dropdown
2.  Click on `Access Keys`
3.  Click `+ New Access Key` in the top right and follow the instructions. Your Access Key file will be downloaded automatically.
4.  Move your Access Key to the default location CLI will look for it

```bash
$ mkdir ~/.hashboard
$ mv ~/Downloads/hb_access_key.json ~/.hashboard/
```

<Callout type="warning">
  Once you navigate away from the page, you will not be able to re-download your
  Access Key. If you lose your Access Key, you will need to delete it and then
  create a new one.
</Callout>

### 2. Install Hashboard CLI

1. Confirm [Python 3](https://www.python.org/downloads/) is installed:

   ```bash
   $ python3 --version
   ```

2. Install Hashboard CLI into a virtual environment:

   ```bash
   $ python3 -m venv venv
   $ source venv/bin/activate
   $ pip3 install hashboard-cli
   ```

3. Confirm sucessful installation:

```bash
$ hb
Usage: hb [OPTIONS] COMMAND [ARGS]...

  A command-line interface for interacting with Hashboard.

Options:
...
```

Use the `--help` flag to see documentation about a specific command. For example:

```bash
$ hb preview --help
Usage: hb preview [OPTIONS] [FILEPATH]

  Validates resource configurations and generates a preview link.

Options:
...
```

## Moving your Access Key

By default, the CLI expects your Access Key to be located at `~/.glean/hashboard_access_key.json`. You can override this by:

- Setting the `HASHBOARD_CREDENTIALS_FILEPATH` environment variable to a different filepath
- Using the `--credentials-filepath` command-line option to use a different filepath
- Setting the `HASHBOARD_PROJECT_ID`, `HASHBOARD_ACCESS_KEY_ID`, and `HASHBOARD_SECRET_ACCESS_KEY_TOKEN` environment variables to the respective values stored in your Access Key file.
<Cards>
  <Card arrow title="CLI Quickstart" href="/docs/data-ops/quickstart" />
</Cards>

## Using environment variables

You can use environment variables to dynamically populate Hashboard configuration files with different values at runtime.

When creating a Build using local files, the CLI will replace placeholders of the form `${ENV_VAR_NAME}` with the corresponding environment variable. For example, if your model file contains:

```yaml
glean: "1.0"
name: My Data Model
source:
  connectionName: ${DATABASE_CONNECTION_NAME}
  physicalName: test_table
```

...then you can preview a Build against your `dev` database by running:

```bash
$ DATABASE_CONNECTION_NAME=dev hb preview
```

Environment variable substitution is not yet supported for Builds that are triggered via a git revision.

## Recommended workflows

The CLI allows you to integrate Hashboard into your existing development and deployment process. As an example, here is a typical workflow that we use when making changes to Hashboard resources or upstream data:

1. Store your Hashboard configuration files in a git repo alongside your data pipeline code.
2. Run your pipelines to populate test data into a separate database or schema.
3. Adjust your Hashboard configuration files as necessary to reflect your intended changes.
4. Run `hb preview` to create a Preview Build, adjusting the `source` section of your model(s) to point at your test dataset.
5. Make any necessary adjustments in the Preview and re-export your new configuration files.
6. Send a Pull Request for all the pending changes, including a link to your Preview Build.
7. Merge the Pull Request into your `main` git branch.
8. Run `hb deploy --git-revision=main` to deploy your new Hashboard resources to your project.

## Continuous integration

You can invoke the Hashboard CLI in a continuous integration system to automatically generate previews or deploy your project.

For example, if you use GitHub, the following GitHub action will generate a Build Preview of the local `glean` directory whenever you send a pull request:

```yaml
name: glean-preview
on: [pull_request]
jobs:
  create-glean-preview:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v2
      - run: pip install glean-cli
      - run: cd glean && hb preview
    env:
      HASHBOARD_PROJECT_ID: ${{ secrets.HASHBOARD_PROJECT_ID_PROD }}
      HASHBOARD_ACCESS_KEY_ID: ${{ secrets.HASHBOARD_ACCESS_KEY_ID_PROD }}
      HASHBOARD_SECRET_ACCESS_KEY_TOKEN: ${{ secrets.HASHBOARD_SECRET_ACCESS_KEY_TOKEN_PROD }}
```

## dbt Utility

`hb preview` and `hb deploy` can optionally accept a flag, `--dbt`, which runs `dbt parse` and then uses the resulting manifest for the corresponding Hashboard build. See the [dbt integration documentation](./dbt-integration.mdx) for more information about the Hashboard dbt integration.
